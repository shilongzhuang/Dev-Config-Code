# d3 v3.x to v4.x Upgrade

I *almost* think Mike Bostock got a kick out of making the upgrade to d3 v4.x as painful and poorly-documented as possible. All of the examples, for some reason, assume the d3 has been loaded in a `<script>` tag and no examples are provided for ES6. What was once very easy doing `import d3 from 'd3';` has become a deep exercise in sifting through issues and debugging in order to make up for the [complete lack of documentation](https://github.com/d3/d3/issues/2899).

## General API

Generally, anything that was previously accessible from `d3.{something}` is still available, with some many exceptions. The key difference is how this information is imported:

```
// Old
import d3 from 'd3';

d3.select('#thing');

// New
import * as d3 from 'd3';

d3.select('#thing');
```

## Multi-attributes

As documented, `selection.attr()` has been reduced to single value settings and `selection.attrs()` must be used for setting multiple attributes. Similar for `selection.styles()`. What is not documented is the import process; thankfully, there's an [issue](https://github.com/d3/d3-selection-multi/issues/6) for that.

```
// Old
import d3 from 'd3';

d3.select('#a').attr({ class: 'b'});

// New
import { select } from 'd3-selection';
import 'd3-selection-multi';  // Will not work on `import * as d3 from 'd3';`

select('#a').attrs({ class: 'b' });
```

## Events

Events have been overhauled to support ES6 arrow functions, which is good. What's not good is the lack of documentation. It's weakly mentioned in the [issue](https://github.com/d3/d3/issues/2246), however.

```
// Old
import d3 from 'd3';

d3.select('#target').on('mouseover', () => {
    const node = d3.event.target;
});

// New
import { select } from 'd3-selection';

select('#target').on('mouseover', (data, groupIndex, nodes) => {
    const node = nodes[0];
});
```

Further, transition events specified with `selection.each()` have been renamed to `selection.on()` for consistency (only clearly mentioned in an [issue](https://github.com/d3/d3-transition/issues/41#issuecomment-220048923):

```
// Old
import d3 from 'd3';

d3.select('#target')
    .transition()
    .duration(500)
    .ease('linear')
    .each('end', () => {
        ///
    });

// New
import { easeLiner } from 'd3';
import { select } from 'd3-selection';

select('#target')
    .transition()
    .duration(500)
    .ease(easeLinear)
    .on('end', () => {
        ///
    });
```

## DOM Nodes

In d3 v3.x, there was no good way to get the individual nodes from a `selectAll` result. Nevertheless, since selections were similar to arrays, nodes could be accessed through indices. d3 v4.x got rid of this in favor of `selection.node()` and `selection.nodes()`, and in a surprising twist, this was [partially documented](https://github.com/d3/d3/blob/master/CHANGES.md#selections-d3-selection):

```
// Old
import d3 from 'd3';

const node = d3.select('#target')[0];
const nodes = d3.selectAll('#target path')[0];

// New
import { select, selectAll } from 'd3-selection';

const node = select('#target').node();
const nodes = selectAll('#target path').nodes();
```
